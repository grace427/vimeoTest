<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="user-scalable=no,width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <script src="https://player.vimeo.com/api/player.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/i18next/17.0.18/i18next.min.js" type="text/javascript"></script>
</head>
<body>
  
    <main>

        <div>
            <select id="selectBox" onchange="i18next.changeLanguage(this.value)">
                <option value="ko">KOREAN</option>
                <option value="en" selected>ENGLISH</option>
                <option value="cn">CNINESE</option>
            </select>
        </div>
    
        <div class="video-container">
            <div id="player"></div>
        </div>


         <!-- ✨ 번역 ✨ -->
        <div id="translationDiv" style="margin-top:300px">
            <h1 id="title"></h1>
            <p id="content"></p>
            <p class="explain"></p>
        </div>

    </main>


<script>
    const koVideoId = '644216112?h=cf288938cb';
    const enVideoId = '643789547?h=971f246dca';
    let videoId = enVideoId;

    var options = {
      url: `https://player.vimeo.com/video/${videoId}`,
      autoplay: true
    };
      
  
    var player = new Vimeo.Player('player', options);
    
    player.setVolume(0); // chrome 등에서 autoplay를 하기 위해 필요한 설정

    player.on('loaded', function() {
        // console.log("loadeddd");
        // const popup = document.querySelector('#overlay');
        // popup.style.visibility = "hidden";
    });
    
    player.on('play', function() {
        // console.log('Played the first video');
    });


    function popup() {
        const popup = document.querySelector('#overlay');
        popup.style.visibility = "visible";
    }

    function popdown() {
        const popup = document.querySelector('#overlay');
        popup.style.visibility = "hidden";
    }

    function seekTo() {
        player.setCurrentTime(20).then(function(seconds) {
        }).catch(function(error) {
        switch (error.name) {
            case 'RangeError':
                console.log(`RangeError ::: ${error}`);
                // The time is less than 0 or greater than the video's duration
                break;
            default:
                // Some other error occurred
                break;
        }
        });
    }

    function moveAhead() {
        player.getCurrentTime().then(seconds => {
            player.setCurrentTime(seconds-10).then(secondsAhead => { 
                console.log(secondsAhead);
            });    
        });
    }

    const select = document.querySelector('#selectBox');

// spring message 쓸 경우 : 서버단에서 언어를 바꾸는 것이기 때문에 페이지 리로드 해야함. ajax로 선택된 언어값과 currentTime 보내서 리로드 하기
// i18next.js 쓸 경우 : 클라이언트단에서 언어를 바꾸는 것이기 때문에 페이지 리로드 없이 바꿀 수 있음. loadVideoById
const handleLanguageOption = () => {
    let currentTime;
    player.getCurrentTime().then((currentTime) => {
        switch(select.value) {
            case 'en':
                player.loadVideo('643789547').then((id) => {
                    player.setCurrentTime(currentTime).then(c => {console.log(c);});        
                }).catch((error) => {
                    console.log(error.name);
                });
                break;
            case 'ko':
                player.loadVideo('644216112').then((id) => {
                    player.setCurrentTime(currentTime).then(c => {console.log(c);});  
                }).catch((error) => {
                    console.log(error.name);
                });
                break;
            case 'cn':
                break;    
        }
    });

}

select.addEventListener('change', handleLanguageOption);
      
    </script>
<script type="module" src="./translation.js"></script>
<!-- <script defer type="text/javascript" src="index.js"></script> -->
</body>